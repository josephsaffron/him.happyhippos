---
id: 166
title: a story of caution (or haxoring microsoft EFS)
date: 2005-12-21T22:46:20+00:00
author: him.happyhippos
layout: post
guid: "166"
permalink: /?p=166
---
A few days ago, my computer died. Not a huge loss, hard drive intact, and I still have a laptop. Or so I thought. 

Anyway, following standard procedure, I immediately hopped on the nearest computer hardware webpage and started drooling over all the latest and greatest hardware of our time. From dual core CPUs to the latest gpu that can render life, the universe, and everything in less than 42 micronanoinfinity seconds, I was all excited about getting my new computer. Then, scaling back by a few orders of magnitude, I decided on a more realistic computer. It was then that I decided to put my hard drive enclosure to good use, prepping my hard drive to be integrated into my brand spanking new system. My hard drive is divided into two partitions, one for data and one for program files/windows. I meticulously went through my primary partition, searching for anything that I needed to back up. After copying everything important over to my secondary partition, I quickformatted the primary partition. Once that was done, it was time to restore everything to the primary partition, so I started by transferring my &#8220;Documents&#8221; folder over. This folder contains my entire life history, essentially everything that I've ever written, sang, or photographed.
  
  
transferring;..

;Access Denied.

What the?!

try again;..

;.Access Denied.

hmm. This is not a good sign. Rewind to March 2005.

I needed a way to password protect some of my important documents, so that they would be safe from prying eyes. Microsoft was touting its new Encrypted File System (EFS), and bundled it free with winXP. Sweet! After encrypting my documents folder though, I was never asked for a password. Hmm. That's strange. I guess this new EFS is a write off. After all, I can still open the folder without a password. Balked, I put this little 5 minute encounter out of my mind. Big mistake. Fast forward to present.

So, that's why my access is denied. Well, no problem, I'll just decrypt that folder. All I need is my encryption keys;.
  
  
;.which are on my primary partition. Which I just formatted. And a quick google search turned up [this site](http://www.windowsnetworking.com/kbase/WindowsTips/Windows2000/AdminTips/Security/Windows2000EncryptingFileSystemEFS.html), which basically says that if you haven't backed up your keys, you are screwed. Oh wait, maybe I can unformat my hard drive using the plethora of free open source tools! ;All none of them. I only managed to find restoration programs which range in price from $90 to $600 US. Which would only be useful in combination with EFS key extraction software. Which ranges from $120 to $600 as well. So currently, my only option is to fork over gobs of cash for two pieces of software that I have to pray will work together and help me recover my data. Not a promising option. Fortunately, my current favourite person in the world has a _much_ better sense of being able to find google pages that are useful and informative. She pointed me to [this page](http://www.beginningtoseethelight.org/efsrecovery/index.php) which gave me a little hope. I had to create a new installation of windows and change its machine code to match my old computer, with the same login and password as the original windows instance. I then needed to copy three specific directories over to this new replica computer. These directories contained the keys, and I hit upon [diskinternals NTFS recovery](http://diskinternals.com/), which recovers any files smaller than 64k. This was perfect, as even the largest key file is only 300 bytes. Armed with these files and a borrowed computer from IT, I managed to retrieve all my data. 

whew! So the moral of the story is, don't encrypt your files. And if you're going to encrypt your files, definitely do NOT use windows EFS. And if you do use EFS, make sure you BACK UP YOUR CERTIFICATES!